"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function MD5(t){function e(t){return n(o(a(t)))}function o(t){return r(s(i(t),8*t.length))}function n(t){for(var e,o=b?"0123456789ABCDEF":"0123456789abcdef",n="",a=0;a<t.length;a++)e=t.charCodeAt(a),n+=o.charAt(e>>>4&15)+o.charAt(15&e);return n}function a(t){for(var e,o,n="",a=-1;++a<t.length;)e=t.charCodeAt(a),o=a+1<t.length?t.charCodeAt(a+1):0,55296<=e&&e<=56319&&56320<=o&&o<=57343&&(e=65536+((1023&e)<<10)+(1023&o),a++),e<=127?n+=String.fromCharCode(e):e<=2047?n+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n}function i(t){for(var e=Array(t.length>>2),o=0;o<e.length;o++)e[o]=0;for(var o=0;o<8*t.length;o+=8)e[o>>5]|=(255&t.charCodeAt(o/8))<<o%32;return e}function r(t){for(var e="",o=0;o<32*t.length;o+=8)e+=String.fromCharCode(t[o>>5]>>>o%32&255);return e}function s(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var o=1732584193,n=-271733879,a=-1732584194,i=271733878,r=0;r<t.length;r+=16){var s=o,l=n,m=a,b=i;o=c(o,n,a,i,t[r+0],7,-680876936),i=c(i,o,n,a,t[r+1],12,-389564586),a=c(a,i,o,n,t[r+2],17,606105819),n=c(n,a,i,o,t[r+3],22,-1044525330),o=c(o,n,a,i,t[r+4],7,-176418897),i=c(i,o,n,a,t[r+5],12,1200080426),a=c(a,i,o,n,t[r+6],17,-1473231341),n=c(n,a,i,o,t[r+7],22,-45705983),o=c(o,n,a,i,t[r+8],7,1770035416),i=c(i,o,n,a,t[r+9],12,-1958414417),a=c(a,i,o,n,t[r+10],17,-42063),n=c(n,a,i,o,t[r+11],22,-1990404162),o=c(o,n,a,i,t[r+12],7,1804603682),i=c(i,o,n,a,t[r+13],12,-40341101),a=c(a,i,o,n,t[r+14],17,-1502002290),n=c(n,a,i,o,t[r+15],22,1236535329),o=u(o,n,a,i,t[r+1],5,-165796510),i=u(i,o,n,a,t[r+6],9,-1069501632),a=u(a,i,o,n,t[r+11],14,643717713),n=u(n,a,i,o,t[r+0],20,-373897302),o=u(o,n,a,i,t[r+5],5,-701558691),i=u(i,o,n,a,t[r+10],9,38016083),a=u(a,i,o,n,t[r+15],14,-660478335),n=u(n,a,i,o,t[r+4],20,-405537848),o=u(o,n,a,i,t[r+9],5,568446438),i=u(i,o,n,a,t[r+14],9,-1019803690),a=u(a,i,o,n,t[r+3],14,-187363961),n=u(n,a,i,o,t[r+8],20,1163531501),o=u(o,n,a,i,t[r+13],5,-1444681467),i=u(i,o,n,a,t[r+2],9,-51403784),a=u(a,i,o,n,t[r+7],14,1735328473),n=u(n,a,i,o,t[r+12],20,-1926607734),o=d(o,n,a,i,t[r+5],4,-378558),i=d(i,o,n,a,t[r+8],11,-2022574463),a=d(a,i,o,n,t[r+11],16,1839030562),n=d(n,a,i,o,t[r+14],23,-35309556),o=d(o,n,a,i,t[r+1],4,-1530992060),i=d(i,o,n,a,t[r+4],11,1272893353),a=d(a,i,o,n,t[r+7],16,-155497632),n=d(n,a,i,o,t[r+10],23,-1094730640),o=d(o,n,a,i,t[r+13],4,681279174),i=d(i,o,n,a,t[r+0],11,-358537222),a=d(a,i,o,n,t[r+3],16,-722521979),n=d(n,a,i,o,t[r+6],23,76029189),o=d(o,n,a,i,t[r+9],4,-640364487),i=d(i,o,n,a,t[r+12],11,-421815835),a=d(a,i,o,n,t[r+15],16,530742520),n=d(n,a,i,o,t[r+2],23,-995338651),o=h(o,n,a,i,t[r+0],6,-198630844),i=h(i,o,n,a,t[r+7],10,1126891415),a=h(a,i,o,n,t[r+14],15,-1416354905),n=h(n,a,i,o,t[r+5],21,-57434055),o=h(o,n,a,i,t[r+12],6,1700485571),i=h(i,o,n,a,t[r+3],10,-1894986606),a=h(a,i,o,n,t[r+10],15,-1051523),n=h(n,a,i,o,t[r+1],21,-2054922799),o=h(o,n,a,i,t[r+8],6,1873313359),i=h(i,o,n,a,t[r+15],10,-30611744),a=h(a,i,o,n,t[r+6],15,-1560198380),n=h(n,a,i,o,t[r+13],21,1309151649),o=h(o,n,a,i,t[r+4],6,-145523070),i=h(i,o,n,a,t[r+11],10,-1120210379),a=h(a,i,o,n,t[r+2],15,718787259),n=h(n,a,i,o,t[r+9],21,-343485551),o=f(o,s),n=f(n,l),a=f(a,m),i=f(i,b)}return Array(o,n,a,i)}function l(t,e,o,n,a,i){return f(m(f(f(e,t),f(n,i)),a),o)}function c(t,e,o,n,a,i,r){return l(e&o|~e&n,t,e,a,i,r)}function u(t,e,o,n,a,i,r){return l(e&n|o&~n,t,e,a,i,r)}function d(t,e,o,n,a,i,r){return l(e^o^n,t,e,a,i,r)}function h(t,e,o,n,a,i,r){return l(o^(e|~n),t,e,a,i,r)}function f(t,e){var o=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(o>>16)<<16|65535&o}function m(t,e){return t<<e|t>>>32-e}var b=0;return e(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}angular.module("Chufaba",["ionic","ngCordova","myRouter"]).run(["$ionicPlatform",function(t){t.ready(function(){setTimeout(function(){navigator.splashscreen&&navigator.splashscreen.hide()},1500),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&(StatusBar.styleLightContent(),StatusBar.backgroundColorByHexString("#21272f"))})}]).config(["$ionicConfigProvider",function(t){t.platform.ios.tabs.style("standard"),t.platform.ios.tabs.position("bottom"),t.platform.android.tabs.style("standard"),t.platform.android.tabs.position("bottom"),t.platform.ios.navBar.alignTitle("center"),t.platform.android.navBar.alignTitle("left"),t.platform.ios.views.transition("ios"),t.platform.android.views.transition("android"),t.backButton.previousTitleText(!1),t.backButton.text(" ")}]).constant("$ionicLoadingConfig",{template:'<ion-spinner icon="lines" class="spinner-balanced"></ion-spinner><p>正在加载</p>'});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),RefreshComponent=function(){function t(e){var o=e.scope,n=void 0===o?null:o,a=e.path,i=void 0===a?"/product":a,r=e.current,s=void 0===r?0:r,l=e.offset,c=void 0===l?10:l,u=e.hasInfinite,d=void 0===u||u,h=e.data,f=void 0===h?{}:h,m=e.reset,b=void 0===m?function(){}:m,g=e.loadData,v=void 0===g?function(){}:g;_classCallCheck(this,t),this.scope=n,this.path=i,this.current=s,this.offset=c,this.hasInfinite=d,this.showInfinite=!!this.hasInfinite,this.data=f,this.reset=b,this.loadData=v}return _createClass(t,[{key:"refresh",value:function(){var t=this;this.hasInfinite&&(this.showInfinite=!0),this.current=0,this.reset(),setTimeout(function(e){t.loadData(),t.scope.$broadcast("scroll.refreshComplete")},1e3)}},{key:"infinite",value:function(){var t=this;setTimeout(function(e){t.loadData()},500)}}]),t}(),Config=function t(e){var o=e.host,n=void 0===o?"127.0.0.1":o,a=e.port,i=void 0===a?"3000":a,r=e.ssl,s=void 0!==r&&r,l=e.activityPoster,c=void 0===l?"/img/default.jpg":l;_classCallCheck(this,t),this.host=n,this.port=i,this.protocol=s?"https":"http",this.serverUrl=this.protocol+"://"+this.host+":"+this.port,this.activityPoster=c},activityPoster={title:"享受得起的定制旅行",image:"http://img.chufaba.me/events/e3d11e3218c1a9102a0848ff54ad4a17n.jpg",url:"http://chufaba.me/activities/23"},config=new Config({host:"127.0.0.1",activityPoster:activityPoster});angular.module("Chufaba").directive("hideTabs",function(t){return{restrict:"A",link:function(e,o,n){e.$on("$ionicView.beforeEnter",function(){e.$watch(n.hideTabs,function(e){t.hideTabs="tabs-item-hide"})}),e.$on("$ionicView.beforeLeave",function(){e.$watch(n.hideTabs,function(e){t.hideTabs="tabs-item-hide"}),e.$watch("$destroy",function(){t.hideTabs=!1})})}}}),angular.module("Chufaba").filter("imageSize",function(){return function(t){return t.replace("!320","!375")}}).filter("avatar",function(){return function(t){var e=/(jpg|png)$/;return t&&e.test(t)||(t="http://cfbassets.b0.upaiyun.com/assets/v2/head.png"),t}}).filter("pointer",function(){return function(t){return"— · "+t.replace(/(、)/g," · ")+" · —"}}).filter("date",function(){return function(t,e){var o=new Date(t);o.setDate(o.getDate()+e);var n=o.getDay(),a="";switch(n){case 0:a="周日";break;case 1:a="周一";break;case 2:a="周二";break;case 3:a="周三";break;case 4:a="周四";break;case 5:a="周五";break;case 6:a="周六"}return o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate()+"，"+a}}),angular.module("myRouter",["ionic"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("guide",{url:"/guide",templateUrl:"views/guide/guide.html",controller:"guideController"}).state("tab",{url:"/tab",abstract:!0,templateUrl:"views/tabs.html",controller:"TabsController"}).state("tab.home",{url:"/home",views:{"tab-home":{templateUrl:"views/tabs/tab-home.html",controller:"HomeController"}}}).state("tab.good-detail",{url:"/good-detail:id",views:{"tab-home":{templateUrl:"views/detail/good.html",controller:"GoodDetailController"}}}).state("tab.home-web",{url:"/web:url:title",views:{"tab-home":{templateUrl:"views/public/web.html",controller:"WebController"}}}).state("tab.destination",{url:"/destination",views:{"tab-destination":{templateUrl:"views/tabs/tab-destination.html",controller:"DestinationController"}}}).state("tab.destination-web",{url:"/web:url:title",views:{"tab-destination":{templateUrl:"views/public/web.html",controller:"WebController"}}}).state("tab.buy",{url:"/buy",views:{"tab-buy":{templateUrl:"views/tabs/tab-buy.html",controller:"BuyController"}}}).state("tab.buy-web",{url:"/web:url:title",views:{"tab-buy":{templateUrl:"views/public/web.html",controller:"WebController"}}}).state("tab.account",{url:"/me",views:{"tab-me":{templateUrl:"views/tabs/tab-me.html",controller:"MeController"}}}).state("tab.me-web",{url:"/web:url:title",views:{"tab-me":{templateUrl:"views/public/web.html",controller:"WebController"}}}),e.otherwise(localStorage.guided?"/tab/home":"/guide")}]),angular.module("Chufaba").controller("TabsController",["$scope","$rootScope","$ionicTabsDelegate","$ionicModal","$http","$cordovaToast",function(t,e,o,n,a,i){function r(){e.userInfo=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):null,e.isLogin=!!e.userInfo&&s()}function s(){if(!e.userInfo.access_token||!e.userInfo.phone)return e.isLogin=!1,!1;var t={phone:e.userInfo.phone,access_token:e.userInfo.access_token};a.post(config.serverUrl+"/user/token",t).then(function(t){1e3===t.data.code?e.isLogin=!0:(e.isLogin=!1,i.showShortBottom("鉴权失败，请重新登录"))}).catch(function(t){e.isLogin=!1,i.showShortBottom("连接失败，请检查网络")})}var l={"tab.home":{tab:!0,navStyle:!1},"tab.good-detail":{tab:!1,navStyle:!0},"tab.home-web":{tab:!1,navStyle:!1},"tab.destination":{tab:!0,navStyle:!1},"tab.destination-web":{tab:!1,navStyle:!1},"tab.buy":{tab:!0,navStyle:!1},"tab.buy-web":{tab:!1,navStyle:!1},"tab.me":{tab:!0,navStyle:!1},"tab.me-web":{tab:!1,navStyle:!1}};e.$on("$ionicView.beforeEnter",function(t,e){l[e.stateName]&&o.showBar(l[e.stateName].tab);var n=$(".bar-stable.bar.bar-header");l[e.stateName]&&l[e.stateName].navStyle?n.css("background","none"):n.css("background","#21272f")}),e.$on("$ionicView.beforeLeave",function(t,e){}),n.fromTemplateUrl("login.html",{scope:t}).then(function(o){e.loginModal=o,e.$on("showLoginModal",function(e){t.loginModal.show()}),e.$on("hideLoginModal",function(e,o){t.loginModal.hide(),o&&r()})}),r(),e.$on("loginCheck",function(t){r()})}]),angular.module("Chufaba").controller("guideController",["$scope","$ionicPlatform","$state","$timeout",function(t,e,o,n){t.index=0,t.slideStatus=[!0,!1,!1],t.delay=!0,t.changeBC=function(e){t.index=e,t.delay=!1,t.slideStatus[e]=!0},t.go=function(){t.out=!0,n(function(){o.go("tab.home")},1e3)}}]),angular.module("Chufaba").controller("GoodDetailController",["$scope","$stateParams","$ionicLoading","$http",function(t,e,o,n){function a(e){$(".bar-stable.bar.bar-header").css("background","rgba(33,39,47,"+e+")"),t.navOpacity=e}var i=window.innerHeight;t.navOpacity=0,t.topImageSize=function(){var e=document.querySelector("#good-detail .scroll").style.transform,o=Number(e.split(", ")[1].replace("px",""));o>=0&&$(".back-image").css("transform","scale("+(o/300+1)+")");var n=Math.abs(o),r=0;r=n>.3*i?((n-.3*i)/100).toFixed(2):0,t.navOpacity!=r&&a(r)};var r=function t(e){var o=e.path,n=void 0===o?"/product":o,a=e.id,i=void 0===a?0:a,r=e.loadData,s=void 0===r?function(){}:r;_classCallCheck(this,t),this.path=n,this.id=i,this.loadData=s};t.detail=new r({path:"/product/good-detail",id:e.id,loadData:function(){var t=this;n({method:"GET",url:config.serverUrl+this.path,params:{id:this.id}}).then(function(e){e.data.code?t.data=e.data.detailData:$cordovaToast.showShortCenter("数据请求失败"),setTimeout(function(){o.hide()},1e3)}).catch(function(t){$cordovaToast.showShortCenter("数据请求失败，请检查网络"),setTimeout(function(){o.hide()},1e3)})}}),t.$on("$ionicView.loaded",function(){o.show()}),t.$on("$ionicView.afterEnter",function(){t.detail.loadData()})}]),angular.module("Chufaba").controller("loginModelController",["$scope",function(t){t.isRegister=!1,t.toLogin=function(e){t.isRegister=!1},t.toRegister=function(e){t.isRegister=!0}}]).controller("formController",["$scope","$http","$cordovaToast","$ionicLoading","$interval",function(t,e,o,n,a){function i(){var e=60;t.vCodeTime=--e,t.timer=a(function(o){t.vCodeTime=--e,e||r()},1e3)}function r(){a.cancel(t.timer),t.vCodeBtnDis=!1,t.vCodeTime=60}function s(e){1e3===e.code?(localStorage.setItem("userInfo",JSON.stringify(e.userInfo)),t.$emit("hideLoginModal",!0),o.showShortBottom("登录成功")):/^302\d{1}$/.test(e.code)?o.showShortBottom("账号或密码错误，登录失败"):/^200\d{1}$/.test(e.code)?o.showShortBottom("服务器错误，登录失败"):(console.log(e.msg),o.showShortBottom("未知错误，登录失败"))}t.vCodeBtnDis=!1,t.vCodeTime=60,t.timer=null,t.getVCode=function(n){t.vCodeBtnDis=!0,i(),e.post(config.serverUrl+"/user/sms",{phone:t.registerData.phone,r:!0}).then(function(t){1e3===t.data.code?o.showShortBottom("验证码发送成功"):3011===t.data.code?(r(),o.showShortBottom("该手机号码已被注册")):(r(),o.showShortBottom("验证码发送失败"))}).catch(function(t){r(),o.showShortBottom("连接失败，请检查网络")})},t.loginSubmit=function(a){if(a.preventDefault(),!t.loginForm.$invalid){n.show({template:'<ion-spinner icon="lines" class="spinner-balanced"></ion-spinner><p>正在登录</p>'});var i=JSON.parse(JSON.stringify(t.loginData));i.password=MD5(i.password),setTimeout(function(t){e.post(config.serverUrl+"/user/login",i).then(function(t){n.hide(),s(t.data)}).catch(function(t){n.hide(),o.showShortBottom("连接失败，请检查网络")})},500)}},t.registerSubmit=function(a){if(a.preventDefault(),!t.registerForm.$invalid&&t.confirm==t.registerData.password){n.show({template:'<ion-spinner icon="lines" class="spinner-balanced"></ion-spinner><p>正在注册</p>'});var i=JSON.parse(JSON.stringify(t.registerData));i.password=MD5(i.password),setTimeout(function(t){e.post(config.serverUrl+"/user/register",i).then(function(t){n.hide(),3011==t.data.code?o.showShortBottom("该号码已被注册"):3005==t.data.code?o.showShortBottom("短信验证码错误"):s(t.data)}).catch(function(t){n.hide(),o.showShortBottom("连接失败，请检查网络")})},500)}}}]),angular.module("Chufaba").controller("WebController",["$scope","$stateParams","$sce","$ionicLoading",function(t,e,o,n){t.title=e.title,document.getElementById("iframe").onload=function(){n.hide()},t.$on("$ionicView.loaded",function(){n.show(),setTimeout(function(){n.hide()},3e3)}),t.$on("$ionicView.afterEnter",function(){t.targetUrl=o.trustAsResourceUrl(e.url)})}]),angular.module("Chufaba").controller("BuyController",["$scope","$http","$cordovaToast",function(t,e,o){t.data=[1,2,3,4],t.spriteHeight=$(".market .measure .sprite").width()+"px",t.market=new RefreshComponent({scope:t,path:"/product/market",offset:0,hasInfinite:!0,data:{},reset:function(){this.data={}},loadData:function(){var n=this;e({method:"GET",url:config.serverUrl+this.path}).then(function(e){"ok"==e.data.code?(console.log(e.data),n.data=e.data.marketData,console.log(t.market.data)):o.showShortCenter("数据请求失败，请尝试下拉刷新"),n.showInfinite=!1,t.$broadcast("scroll.infiniteScrollComplete")}).catch(function(t){o.showShortCenter("数据请求失败，请检查网络")})}}),t.$on("$ionicView.afterEnter",function(){})}]),angular.module("Chufaba").controller("DestinationController",["$scope",function(t){t.data=[1,2,3,4]}]);var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}();angular.module("Chufaba").controller("HomeController",["$scope","$ionicSlideBoxDelegate","$cordovaToast","$http","$state",function(t,e,o,n,a){var i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,t),this.activeItem=e}return _createClass(t,[{key:"setActive",value:function(t){this.activeItem=t,e.slide(this.activeItem)}}]),t}();t.homeTab=new i(1),t.good=new RefreshComponent({scope:t,path:"/product/good-list",data:{items:[]},reset:function(){this.data.items.length=0},loadData:function(){var e=this;n({method:"GET",url:config.serverUrl+this.path,params:{current:this.current,offset:this.offset}}).then(function(n){"ok"==n.data.code&&n.data.items.length>0?(e.data.items=e.data.items.concat(n.data.items),e.current+=e.offset):"ok"==n.data.code&&0===n.data.items.length?(e.showInfinite=!1,o.showShortCenter("没有更多数据了!")):o.showShortCenter("数据请求失败，请尝试下拉刷新"),t.$broadcast("scroll.infiniteScrollComplete")}).catch(function(t){o.showShortCenter("数据请求失败，请检查网络")})}}),t.good.data.banner={title:config.activityPoster.title,image:config.activityPoster.image,url:config.activityPoster.url}}]).service("HomeService",[]),angular.module("Chufaba").controller("MeController",["$scope",function(t){t.openLogin=function(e){t.$emit("showLoginModal")},t.logout=function(e){confirm("确认退出登录吗?")&&(localStorage.removeItem("userInfo"),t.$emit("loginCheck"))}}]);
//# sourceMappingURL=ionic.app.min.js.map
